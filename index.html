<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Master Panel • parkingANAN</title>
<style>
  :root{
    --bg:#0a111e;
    --card:#0b1220;
    --accent:#7dd3fc;
    --muted:#6b7785;
    --radius:14px;
    --danger:#ef4444;
    --font:"Inter",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:var(--font);background:linear-gradient(135deg,var(--bg),#050a14);color:#e6eef6;display:flex;align-items:center;justify-content:center}
  .dash{
    width:100%;
    max-width:480px;
    display:flex;
    flex-direction:column;
    gap:24px;
    padding:0 16px;
  }
  .card{
    background:var(--card);
    padding:28px 24px;
    border-radius:var(--radius);
    box-shadow:0 12px 32px rgba(2,6,23,.7);
    backdrop-filter:blur(4px);
  }
  h2{margin:0 0 12px;font-size:18px;font-weight:600;letter-spacing:.5px}
  .sub{color:var(--muted);font-size:13px;margin-bottom:20px}
  .row{display:flex;gap:12px}
  button{
    flex:1;
    padding:14px;
    border:none;
    border-radius:10px;
    background:var(--accent);
    color:#071021;
    font-weight:600;
    font-size:15px;
    cursor:pointer;
    transition:background .25s ease,transform .15s ease;
  }
  button:hover{background:#a1e3ff}
  button:active{transform:scale(.98)}
  button.danger{background:var(--danger);color:#fff}
  button.danger:hover{background:#f87171}
  button.gate{background:#10b981;color:#fff}
  button.gate:hover{background:#34d399}
  button.gate.closed{background:#ef4444}
  button.gate.closed:hover{background:#f87171}
  .slot-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .slot-btn{position:relative;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);color:#e6eef6;font-size:15px;padding:18px;border-radius:10px;cursor:pointer;transition:border-color .25s ease,box-shadow .25s ease}
  .slot-btn:hover{border-color:var(--accent)}
  .slot-btn.active{border-color:var(--accent);box-shadow:0 0 0 3px rgba(125,211,252,.15)}
  .stop{
    position:absolute;
    right:6px;
    top:50%;
    transform:translateY(-50%);
    padding:6px 10px;
    font-size:12px;
    background:var(--danger);
    color:#fff;
    border-radius:6px;
    display:none;
  }
  .slot-btn.active .stop{display:block}
  footer{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
</style>
</head>
<body>

<div class="dash">

  <!-- ROTATION -->
  <div class="card">
    <h2>Manual Rotation</h2>
    <div class="sub">Tap &amp; hold to spin the rack</div>
    <div class="row">
      <button id="ccw">↺ Counter-clockwise</button>
      <button id="cw">↻ Clockwise</button>
    </div>
  </div>

  <!-- SLOT SELECTOR -->
  <div class="card">
    <h2>Go to Slot</h2>
    <div class="sub">Pick a slot; press stop anytime</div>
    <div class="slot-grid" id="slotGrid">
      <!-- 1-6 buttons injected by JS -->
    </div>
  </div>

  <!-- GATE -->
  <div class="card">
    <h2>Entry Gate</h2>
    <button id="gate" class="gate">Open Gate</button>
  </div>

  <!-- DIAGNOSTICS -->
  <div class="card">
    <h2>System</h2>
    <button id="diag">Run Full Diagnosis</button>
  </div>

  <footer><b>parkingANAN</b> © 2025</footer>
</div>

<script>
/* ---------- helpers ---------- */
const $ = q => document.querySelector(q);
const on = (el,ev,cb) => el.addEventListener(ev,cb);

/* ---------- rotation ---------- */
let spinTimer = null;
function spin(dir){
  fetch('/api/rotate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({direction:dir})});
}
function stopSpin(){
  fetch('/api/stop',{method:'POST'});
}
on($('#cw'),'mousedown',()=>{spin('cw');spinTimer=setInterval(()=>spin('cw'),200)});
on($('#ccw'),'mousedown',()=>{spin('ccw');spinTimer=setInterval(()=>spin('ccw'),200)});
['mouseup','mouseleave'].forEach(ev=>{
  on($('#cw'),ev,()=>{clearInterval(spinTimer);stopSpin()});
  on($('#ccw'),ev,()=>{clearInterval(spinTimer);stopSpin()});
});

/* ---------- slot selector ---------- */
const grid = $('#slotGrid');
for(let i=1;i<=6;i++){
  const b = document.createElement('button');
  b.className='slot-btn'; b.textContent=i; b.dataset.slot=i;
  b.innerHTML+=`<span class="stop">STOP</span>`;
  grid.appendChild(b);
}
grid.addEventListener('click',e=>{
  const btn = e.target.closest('.slot-btn');
  if(!btn) return;
  const slot = btn.dataset.slot;
  if(btn.classList.contains('active')){
    /* stop */
    fetch('/api/stop',{method:'POST'});
    document.querySelectorAll('.slot-btn').forEach(x=>x.classList.remove('active'));
  }else{
    /* go */
    document.querySelectorAll('.slot-btn').forEach(x=>x.classList.remove('active'));
    btn.classList.add('active');
    fetch('/api/goto',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({slot})});
  }
});

/* ---------- gate ---------- */
let gateOpen = false;
on($('#gate'),'click',()=>{
  gateOpen = !gateOpen;
  $('#gate').textContent = gateOpen ? 'Close Gate' : 'Open Gate';
  $('#gate').classList.toggle('closed');
  fetch('/api/gate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({open:gateOpen})});
});

/* ---------- diagnostics ---------- */
on($('#diag'),'click',()=>{
  fetch('/api/diagnose',{method:'POST'})
    .then(r=>r.json())
    .then(d=> alert(d.summary || 'Diagnostics complete'));
});
</script>
</body>
</html>
